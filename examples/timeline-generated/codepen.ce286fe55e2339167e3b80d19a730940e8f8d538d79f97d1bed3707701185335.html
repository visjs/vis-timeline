<html>
  <head>
    <meta charset="utf-8" />
    <title>Timeline | other | Clustering example</title>
  </head>
  <body>
    <form
      id="form"
      action="https://codepen.io/pen/define"
      method="post"
      target="_self"
    >
      <input
        type="hidden"
        name="data"
        value='{"css":"body,\nhtml {\n  font-family: arial, sans-serif;\n  font-size: 11pt;\n}\n\n#visualization {\n  box-sizing: border-box;\n  width: 100%;\n  height: 300px;\n}\n\n.vis-cluster {\n  min-width: 145px;\n}\n\n.cluster-header {\n  display: block;\n  font-weight: 600;\n}\n\n.slider-value {\n  border: 0;\n  background: transparent;\n}\n","css_external":"","html":"<p>This example demonstrate using clustering.</p>\n<button class=\"zoom\" data-dir=\"1\">Zoom in</button>\n<button class=\"zoom\" data-dir=\"-1\">Zoom out</button>\n<br />\n<input type=\"checkbox\" id=\"clusterCheckbox\" />Enable clustering\n<br />\n<input type=\"checkbox\" id=\"groupItemsCheckBox\" />Enable grouping\n<br />\n<br />\n\n<div>\n  <label for=\"total-days-number\">Days number:</label>\n  <input class=\"slider-value\" type=\"text\" id=\"total-days-number\" readonly=\"\" />\n  <div class=\"slider\" id=\"total-days-slider\"></div>\n</div>\n\n<div>\n  <label for=\"orders-per-day-number\">Orders per day number:</label>\n  <input\n    class=\"slider-value\"\n    type=\"text\"\n    id=\"orders-per-day-number\"\n    readonly=\"\"\n  />\n  <div class=\"slider\" id=\"orders-per-day-slider\"></div>\n</div>\n<br />\n<div>\n  <label for=\"total-orders-count\">Total orders:</label>\n  <input class=\"slider-value\" type=\"text\" id=\"total-orders-count\" readonly=\"\" />\n</div>\n\n<br />\n<div id=\"visualization\"></div>\n","js":"function getRandomArbitrary(min, max) {\n  return Math.round(Math.random() * (max - min) + min);\n}\n\nfunction getRandomSignum() {\n  return Math.round(Math.random()) ? 1 : -1;\n}\n\nvar names = [\"Group 1\", \"Group 2\", \"Group 3\", \"Group 4\"];\nvar groups = new vis.DataSet();\nvar groupsCount = 0;\nfor (var i in names) {\n  var name = names[i];\n  groups.add({ id: name, content: name });\n}\n\nfunction getTimelineData() {\n  const offsets = [];\n  const totalDaysCount = $(\"#total-days-slider\").slider(\"value\");\n  const itemsInClusterCount = $(\"#orders-per-day-slider\").slider(\"value\");\n\n  const before = [\n    Array.from(\n      new Array(Math.round(totalDaysCount / 2)),\n      function (val, index) {\n        return index - totalDaysCount + 1;\n      },\n    ),\n  ];\n  const after = [\n    Array.from(\n      new Array(Math.round(totalDaysCount / 2)),\n      function (val, index) {\n        return index + 1;\n      },\n    ),\n  ];\n\n  for (var i in before) {\n    var offset = before[i];\n    offsets.push(...offset);\n  }\n\n  for (var i in after) {\n    var offset = after[i];\n    offsets.push(...offset);\n  }\n\n  const clusterCenters = [];\n  for (let offset of offsets) {\n    const date = moment().add(\"days\", offset);\n    clusterCenters.push(date);\n  }\n\n  const timeLineData = [];\n  let nodeIndex = 0;\n  for (var i in clusterCenters) {\n    let clusterCenter = clusterCenters[i];\n    for (\n      let clusterNodeIdx = 0;\n      clusterNodeIdx < itemsInClusterCount;\n      ++clusterNodeIdx\n    ) {\n      const minutesShift = getRandomArbitrary(1, 60) * getRandomSignum();\n      const hoursShift = getRandomArbitrary(1, 5) * getRandomSignum();\n      const secondsShift = getRandomArbitrary(1, 60) * getRandomSignum();\n\n      const start = clusterCenter\n        .clone()\n        .add(+minutesShift, \"m\")\n        .add(+hoursShift, \"h\")\n        .add(+secondsShift, \"s\");\n\n      const end = start.clone().add(60, \"m\");\n\n      ++nodeIndex;\n\n      const currentGroup = names[getRandomArbitrary(0, names.length - 1)];\n\n      timeLineData.push({\n        id: nodeIndex,\n        content: \"Order: \" + nodeIndex,\n        start: start.format(\"YYYY/MM/DD HH:mm:ss\"),\n        end: end.format(\"YYYY/MM/DD HH:mm:ss\"),\n        width: 50,\n        group: currentGroup,\n      });\n    }\n  }\n  return timeLineData;\n}\n\n$(\"#groupItemsCheckBox\").change(function () {\n  if (this.checked) {\n    timeline.setGroups(groups);\n  } else {\n    timeline.setGroups(null);\n  }\n});\n\n$(\"#orders-per-day-slider\").slider({\n  value: 10,\n  min: 1,\n  max: 1000,\n  slide: function (event, ui) {\n    setTimeout(() => {\n      $(\"#orders-per-day-number\").val(ui.value);\n      timeLineData = getTimelineData();\n      $(\"#total-orders-count\").val(timeLineData.length);\n      timeline.setItems(timeLineData);\n    });\n  },\n});\n\n$(\"#total-days-slider\").slider({\n  value: 1,\n  min: 2,\n  max: 10,\n  step: 2,\n  slide: function (event, ui) {\n    setTimeout(() => {\n      $(\"#total-days-number\").val(ui.value);\n      timeLineData = getTimelineData();\n      $(\"#total-orders-count\").val(timeLineData.length);\n      timeline.setItems(timeLineData);\n    });\n  },\n});\n\n$(\"#total-days-number\").val($(\"#total-days-slider\").slider(\"value\"));\n\n$(\"#orders-per-day-number\").val($(\"#orders-per-day-slider\").slider(\"value\"));\n\n// create visualization\nvar container = document.getElementById(\"visualization\");\nvar defaultOptions = {\n  stack: true,\n  maxHeight: 800,\n  height: 600,\n  groupOrder: \"content\", // groupOrder can be a property name or a sorting function,\n  template: (itemData, element, data) => {\n    if (data.isCluster) {\n      return `<span class=\"cluster-header\">Cluster</span><div>containg ${data.items.length} items </div>`;\n    } else {\n      return `<div>${data.content}</div>`;\n    }\n  },\n};\n\nvar timeline = new vis.Timeline(container);\ntimeline.setOptions(defaultOptions);\n\nvar timeLineData = getTimelineData();\n$(\"#total-orders-count\").val(timeLineData.length);\ntimeline.setItems(timeLineData);\n\ntimeline.fit();\n\n$(\".zoom\").on(\"click\", function () {\n  var dir = $(this).data(\"dir\");\n  var range = timeline.getWindow();\n  var interval = range.end - range.start;\n\n  timeline.setWindow({\n    start: range.start.valueOf() - interval * dir * 0.2,\n    end: range.end.valueOf() + interval * dir * 0.2,\n  });\n});\n\n$(\"#clusterCheckbox\").change(function () {\n  var options = {};\n  if (this.checked) {\n    var clusterOpts = {\n      cluster: {\n        titleTemplate:\n          \"Cluster containing {count} events. Zoom in to see the individual events.\",\n        showStipes: true,\n      },\n    };\n    Object.assign(options, defaultOptions, clusterOpts);\n  } else {\n    Object.assign(options, defaultOptions);\n  }\n  timeline.setOptions(options);\n});\n","js_external":"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js;https://visjs.github.io/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js;https://code.jquery.com/jquery-1.12.4.js;https://code.jquery.com/ui/1.12.1/jquery-ui.js","title":"Timeline | other | Clustering example"}'
      />
      <button id="open" alt="JSFiddle" title="JSFiddle">Open CodePen</button>
    </form>

    <script type="text/javascript">
      document.getElementById("open").click();
    </script>
  </body>
</html>
